var fr;if(fr){if("object"!=typeof fr)throw new Error("fr already exists and not an object")}else fr={};if(fr.bea_sender){if("object"!=typeof fr.bea_sender)throw new Error("fr.bea_sender already exists and not an object")}else fr.bea_sender={};fr.bea_sender={views:{},models:{}};

fr.bea_sender.tools={uniqid:function(e,t){"undefined"==typeof e&&(e="");var n,i=function(e,t){return e=parseInt(e,10).toString(16),t<e.length?e.slice(e.length-t):t>e.length?Array(1+(t-e.length)).join("0")+e:e};return this.php_js||(this.php_js={}),this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*Math.random())),this.php_js.uniqidSeed++,n=e,n+=i(parseInt((new Date).getTime()/1e3,10),8),n+=i(this.php_js.uniqidSeed,5),t&&(n+=(10*Math.random()).toFixed(8).toString()),n},template:_.memoize(function(e){var t,n={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(i){return(t=t||_.template(jQuery("#bea-sender-"+e).html(),null,n))(i)}})};

"use strict";fr.bea_sender.models.Log=Backbone.Model.extend({defaults:{logs:""}});

"use strict";fr.bea_sender.views.Exporter=Backbone.View.extend({log:"",nonce:"",type:"",action:"",launched:!1,button:"",events:{"click .generate":"generate"},initialize:function(){this.log=new fr.bea_sender.views.Log},render:function(){return jQuery(this.$el).find(".log").html(this.log.render().$el),this},generate:function(e){if(e.preventDefault(),!0!==this.launched){this.launched=!0;var t=this;this.nonce=e.currentTarget.getAttribute("data-nonce"),this.type=e.currentTarget.getAttribute("data-type"),this.action=e.currentTarget.getAttribute("data-action"),this.button=jQuery(e.currentTarget),this.button.attr("disabled","disabled"),this.log.add_log({status:"success",message:"Send request to generate the CSV file."}),this.render(),jQuery.ajax({url:ajaxurl,dataType:"json",type:"POST",data:{action:"bea_sender_launch_cron",type:t.type,nonce:t.nonce},success:function(e){return t.log.add_log({status:"success",message:e.message}),0==e.status?(this.launched=!1,t.button.removeAttr("disabled"),!1):(t.log.add_log({status:"success",message:"Checking if the lock file exists"}),void window.setTimeout(function(){t.check_file()},2e3))}})}},check_file:function(){var e=this;jQuery.ajax({url:ajaxurl,dataType:"json",type:"POST",data:{action:"bea_sender_get_check_file",nonce:e.nonce,type:e.type},success:function(t){return"error"==t.status?(e.log.add_log({status:"error",message:t.message}),this.launched=!1,e.button.removeAttr("disabled"),!1):0==t.finished?(window.setTimeout(function(){e.check_file()},2e3),e.log.add_log({status:"success",message:t.message}),!1):(e.log.add_log({status:"success",message:t.message}),this.launched=!1,void e.button.removeAttr("disabled"))}})}});

"use strict";fr.bea_sender.views.Log=Backbone.View.extend({tagName:"div",className:"metabox-holder has-right-sidebar",template:fr.bea_sender.tools.template("log"),template_log:fr.bea_sender.tools.template("log-line"),initialize:function(){this.model=new fr.bea_sender.models.Log({id:fr.bea_sender.tools.uniqid()})},render:function(){return this.$el.html(this.template({logs:this.model.get("logs")})),this},add_log:function(e){var t=this.model.get("logs");_.isArray(t)||(t=[]),t.push(e),this.model.set("logs",t),this.$el.find(".inside").append(this.template_log(e))}});

jQuery(function(){jQuery(".bea-sender-export").each(function(e,r){new fr.bea_sender.views.Exporter({el:r})})});

//# sourceMappingURL=app.min.js.map